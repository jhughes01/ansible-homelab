---
image: docker:git
services:
  - docker:dind
stages:
  - test

before_script:
  - chmod 700 ansible.cfg # Correct permissions - see: https://github.com/ansible/ansible/pull/42142/files

role-test-certbot:
  image: retr0h/molecule
  stage: test
  tags:
    - docker
  script:
    - docker -v
    - python -V
    - ansible --version
    - molecule --version
    - pushd roles/certbot
    - molecule test

role-test-common:
  image: retr0h/molecule
  stage: test
  tags:
    - docker
  script:
    - docker -v
    - python -V
    - ansible --version
    - molecule --version
    - pushd roles/common
    - molecule test

role-test-plex:
  image: retr0h/molecule
  stage: test
  tags:
    - docker
  script:
    - docker -v
    - python -V
    - ansible --version
    - molecule --version
    - pushd roles/plex
    - molecule test